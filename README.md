# README: Last-Mile Delivery Optimization

## คำอธิบายโครงการ

โปรแกรมนี้ใช้เปรียบเทียบแบบจำลอง Mixed Integer Programming (MIP) 2 แบบสำหรับการเลือกศูนย์กระจายสินค้าในระบบจัดส่งระยะสุดท้าย:

1. **Basic MIP** - แบบจำลองพื้นฐานที่ลดต้นทุนรวมเท่านั้น
2. **FTHR-MIP** - แบบจำลองที่พิจารณาอัตราการจัดส่งสำเร็จครั้งแรก (First-Time Hit Rate)

---

## สิ่งที่ต้องเตรียมก่อนใช้งาน

### 1. ซอฟต์แวร์ที่จำเป็น

- Python 3.7 ขึ้นไป
- pip (Python package manager)

### 2. ไลบรารีที่ต้องติดตั้ง

```bash
pip install pandas
pip install pulp
```

หรือติดตั้งพร้อมกันด้วยคำสั่ง:

```bash
pip install pandas pulp
```

---

## โครงสร้างไฟล์

โปรเจคต้องมีไฟล์ดังนี้ในโฟลเดอร์เดียวกัน:

```
project_folder/
├── script.py           # ไฟล์โปรแกรมหลัก
├── matrix.csv          # ข้อมูลระยะทางระหว่างลูกค้าและศูนย์
├── dcs.csv            # ข้อมูลศูนย์กระจายสินค้า
└── demand.csv         # ข้อมูลความต้องการของลูกค้า
```

### รายละเอียดไฟล์ข้อมูล

**matrix.csv**
```
customer_id,dc_id,distance_km
1,1,21
1,2,4
...
```

**dcs.csv**
```
dc_id,capacity,fixed_cost
1,70,3500
2,70,3600
...
```

**demand.csv**
```
customer_id,demand
1,6
2,4
...
```

---

## วิธีใช้งาน

### 1. ตรวจสอบไฟล์

ตรวจสอบว่ามีไฟล์ CSV ทั้ง 3 ไฟล์ในโฟลเดอร์เดียวกับ script.py

### 2. รันโปรแกรม

```bash
python script.py
```

### 3. รอผลลัพธ์

โปรแกรมจะแสดงผลบนหน้าจอและสร้างไฟล์ผลลัพธ์อัตโนมัติ

---

## ผลลัพธ์ที่ได้

### ไฟล์ที่สร้างขึ้นอัตโนมัติ:

1. **comparison_summary.csv** - ตารางเปรียบเทียบสรุป
2. **basic_mip_assignments.csv** - รายละเอียดการจับคู่ของ Basic MIP
3. **fthr_mip_assignments.csv** - รายละเอียดการจับคู่ของ FTHR-MIP
4. **dc_summary.csv** - สรุปศูนย์กระจายสินค้าที่เปิด
5. **full_report.txt** - รายงานผลแบบเต็ม

### ข้อมูลที่แสดงบนหน้าจอ:

- สถานะการแก้ปัญหา (Optimal/Infeasible)
- ต้นทุนรวมของแต่ละแบบจำลอง
- ศูนย์กระจายสินค้าที่เปิดใช้งาน
- ระยะทางรวมและเฉลี่ย
- อัตรา FTHR เฉลี่ย
- เวลาที่ใช้ในการคำนวณ
- ตารางเปรียบเทียบ

---

## พารามิเตอร์ที่สำคัญ

### อัตราค่าขนส่ง
```python
TRANSPORT_COST_PER_KM = 15  # บาท/กิโลเมตร
```

### ช่วง FTHR ตามระยะทาง
- 0-5 กม. : FTHR = 0.95
- 5-10 กม. : FTHR = 0.85
- 10-15 กม. : FTHR = 0.70
- 15-20 กม. : FTHR = 0.55
- มากกว่า 20 กม. : FTHR = 0.40

หากต้องการปรับค่าเหล่านี้ ให้แก้ไขในไฟล์ script.py

---

## การแก้ปัญหาเบื้องต้น

### ปัญหา: ModuleNotFoundError

**สาเหตุ:** ไม่ได้ติดตั้งไลบรารีที่จำเป็น

**วิธีแก้:**
```bash
pip install pandas pulp
```

### ปัญหา: FileNotFoundError

**สาเหตุ:** ไม่พบไฟล์ CSV

**วิธีแก้:**
- ตรวจสอบว่าไฟล์ CSV อยู่ในโฟลเดอร์เดียวกับ script.py
- ตรวจสอบชื่อไฟล์ว่าถูกต้อง (matrix.csv, dcs.csv, demand.csv)

### ปัญหา: KeyError หรือ ข้อมูลผิดพลาด

**สาเหตุ:** ชื่อคอลัมน์ในไฟล์ CSV ไม่ตรงกับที่โปรแกรมต้องการ

**วิธีแก้:**
- ตรวจสอบให้แน่ใจว่าชื่อคอลัมน์เป็นไปตามที่ระบุในส่วน "รายละเอียดไฟล์ข้อมูล"
- ไม่มีช่องว่างหรือตัวอักษรพิเศษในชื่อคอลัมน์

### ปัญหา: Solver แก้ปัญหาไม่ได้ (Infeasible)

**สาเหตุ:** ข้อมูลไม่สอดคล้องกัน เช่น ความต้องการรวมมากกว่าความจุรวม

**วิธีแก้:**
- ตรวจสอบว่าความจุของศูนย์เพียงพอต่อความต้องการของลูกค้า
- ตรวจสอบข้อมูลว่ามีค่าติดลบหรือค่าผิดปกติหรือไม่

---

## ข้อมูลเพิ่มเติม

### เวลาในการคำนวณ

- ข้อมูล 50 ลูกค้า, 8 ศูนย์: ประมาณ 0.1-0.5 วินาที
- ข้อมูล 100 ลูกค้า, 10 ศูนย์: ประมาณ 1-3 วินาที

หากใช้เวลานานเกินไป ให้ตรวจสอบว่าข้อมูลมีขนาดใหญ่เกินไปหรือไม่

### ข้อจำกัดของโปรแกรม

- ใช้ได้กับปัญหาขนาดเล็กถึงกลาง (ลูกค้าไม่เกิน 500 ราย)
- ต้องใช้ข้อมูลที่สมบูรณ์ ไม่มีค่าว่างหรือค่า NULL

---

## ตัวอย่างผลลัพธ์

```
======================================================================
MODEL 1: BASIC MIP (without FTHR)
======================================================================
Status: Optimal
Total Cost: 20,450.00 THB
Opened DCs: [1, 3, 5, 7]
Number of DCs: 4
Average FTHR: 0.7284 (72.84%)

======================================================================
MODEL 2: FTHR-MIP (with First-Time Hit Rate)
======================================================================
Status: Optimal
Total Cost: 21,680.00 THB
Opened DCs: [1, 2, 3, 5, 7]
Number of DCs: 5
Average FTHR: 0.8156 (81.56%)
Expected Re-delivery Cost: 945.50 THB
```
